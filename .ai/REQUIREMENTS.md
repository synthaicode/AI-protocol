---
status: draft
created: 2026-01-01
awaiting_review:
  - プロセスの妥当性
  - 確認条件の網羅性
---

# 要求→要件変換ルール

## 概要

ユーザーの**要求**（曖昧で自由な言葉）を、用語統一された**要件**（具体的で実行可能な形）に変換するプロセスを定義する。

## 要求と要件の違い

| 項目 | 要求 | 要件 |
|------|------|------|
| 定義 | ユーザーが望むこと | 要求を具体化・用語統一したもの |
| 言葉 | 自由、曖昧、用語集外 | 用語集準拠、明確 |
| 出所 | [明示] | [明示] + [推論] + [仮定] + [補完] |
| 例 | 「速くして」 | 「ページ読み込み時間を500ms以内に短縮」 |

## 変換プロセス

```
[ユーザーの言葉] 曖昧、自由、用語集外
        ↓
    ① 要求理解（意図・目的の把握）
        ↓
    ② 制約照合（既存決定・原則との整合確認）
        ↓
    ③ 要件化（具体化・用語統一）
        ↓
[用語集準拠の要件]
```

### ① 要求理解

**目的**: ユーザーの真の意図を理解する

**実施内容**:
- WHYの把握: なぜこれが必要か
- 背景の理解: どのような文脈で発生したか
- 期待する結果: どうなれば成功か

**質問例**:
- 「この機能の目的は何ですか？」
- 「どのような問題を解決したいですか？」
- 「どうなれば完了と言えますか？」

**成果物**: 要求の意図を自分の言葉で要約

### ② 制約照合

**目的**: 既存の決定事項や原則との整合性を確認

**確認対象**:
1. **LOG.md** - 過去の決定事項との矛盾チェック
2. **GLOSSARY.md** - 用語の定義確認
3. **BEHAVIOR.md** - 境界線（ガードレール）の確認
4. **{project}.md** - プロジェクト固有の制約

**照合結果**:
- ✅ 整合: そのまま要件化へ
- ⚠️ 矛盾: エスカレーション（優先順位確認）
- ❓ 不明: 仮定を置いて要件化、レビュー対象に

### ③ 要件化

**目的**: 実行可能な形に具体化し、用語を統一

**実施内容**:
1. **用語統一**: GLOSSARY.mdの正式用語に変換
2. **具体化**: 曖昧さを排除、測定可能に
3. **出所タグ付与**: 各要素に [明示][推論][仮定][補完]
4. **境界線明記**: やっていいこと/いけないこと
5. **完了基準設定**: Definition of Done

**成果物**: 実行可能な要件ドキュメント

## 確認が必要な条件

| 条件 | アクション | 理由 |
|------|-----------|------|
| 新出用語がある | 用語確認 | 用語集の一貫性維持 |
| 既存制約と矛盾 | 優先順位確認 | 決定の整合性確保 |
| 複数解釈が可能 | 意図確認 | 誤った実装の防止 |
| 影響範囲が大きい | 承認を求める | リスク管理 |
| [仮定]が多い（3つ以上） | 仮定の確認 | 確実性向上 |
| 上記に該当しない | 自律で要件化 | 効率化 |

## 実践例

### 例1: 曖昧な要求

**ユーザー**: 「速くして」

#### ① 要求理解

AI: 「速く」の対象を確認
- 質問: 「何を速くしたいですか？ページ読み込み？API応答？ビルド時間？」
- ユーザー: 「ページ読み込みが遅い」

AI: 背景を確認
- 質問: 「現在どのくらい時間がかかっていますか？」
- ユーザー: 「3秒くらい」

AI: 期待を確認
- 質問: 「どのくらいが理想ですか？」
- ユーザー: 「1秒以内が良い」

#### ② 制約照合

- LOG.mdを確認: パフォーマンス関連の過去決定なし
- {project}.mdを確認: 外部API依存あり（変更不可）
- BEHAVIOR.mdを確認: 既存API変更禁止

#### ③ 要件化

**要件ドキュメント**:
```yaml
目的: ページ読み込み時間の短縮 [明示]
現状: 3秒 [明示]
目標: 1秒以内 [明示]

対象ページ: 全ページ [仮定] （特定ページか要確認）

制約:
  - 既存API変更禁止 [推論] BEHAVIOR.md参照
  - 外部API依存部分は変更不可 [推論] {project}.md参照

完了基準:
  - [ ] 対象ページの読み込み時間が1秒以内
  - [ ] 既存機能に影響がないこと
  - [ ] パフォーマンステストでの検証

実装方針（候補）:
  - コード分割 [補完]
  - 画像最適化 [補完]
  - キャッシュ戦略 [補完]

awaiting_review:
  - 対象ページの範囲（全ページか特定ページか）
```

### 例2: 新機能要求

**ユーザー**: 「ユーザーがコメントできるようにして」

#### ① 要求理解

AI: 機能の詳細を確認
- 認証は必要？ → はい
- 編集・削除は可能？ → 投稿者のみ可能
- 返信機能は？ → 不要

#### ② 制約照合

- LOG.md: 既存の認証方式はJWT [明示]
- GLOSSARY.md: 「ユーザー」は「認証済みユーザー」と同義
- BEHAVIOR.md: データベーススキーマ変更は承認が必要

#### ③ 要件化

**要件ドキュメント**:
```yaml
機能: コメント投稿機能 [明示]

対象ユーザー: 認証済みユーザー [推論] GLOSSARY.md参照

機能要件:
  - コメント投稿: 可能 [明示]
  - コメント編集: 投稿者のみ [明示]
  - コメント削除: 投稿者のみ [明示]
  - 返信機能: 不要 [明示]

技術要件:
  - 認証方式: JWT [推論] LOG.mdの既存決定に従う
  - データベース: 新規テーブル追加 [推論]
    - テーブル名: comments [補完]
    - カラム: id, user_id, content, created_at, updated_at [補完]

制約:
  - 既存認証システムを使用 [推論]
  - スパム対策は今回対象外 [仮定]

完了基準:
  - [ ] 認証済みユーザーがコメント投稿可能
  - [ ] 投稿者のみ編集・削除可能
  - [ ] APIエンドポイントのテスト完備
  - [ ] データベースマイグレーション実施

awaiting_review:
  - データベーススキーマ変更の承認
  - スパム対策の要否
```

### 例3: バグ報告

**ユーザー**: 「ログインできない」

#### ① 要求理解

AI: 状況を確認
- いつから？ → 今朝から
- 誰が？ → 一部のユーザー
- エラーは？ → 「Invalid token」

#### ② 制約照合

- LOG.md: トークン有効期限は24時間 [明示]
- コード確認: トークン検証ロジックを発見

#### ③ 要件化

**要件ドキュメント**:
```yaml
問題: 一部ユーザーのログイン失敗 [明示]
エラー: "Invalid token" [明示]
発生時期: 2026-01-01 朝から [明示]
影響範囲: 一部ユーザー [明示]

原因（推定）:
  - トークン期限切れ処理のバグ [仮定]
  - タイムゾーン計算ミス [仮定]

調査項目:
  - [ ] エラーログの詳細確認
  - [ ] トークン検証ロジックのレビュー
  - [ ] 影響ユーザーの共通点分析

修正方針:
  - トークン期限切れ時の適切なエラーハンドリング [補完]
  - フロントエンドでの再ログイン誘導 [補完]

完了基準:
  - [ ] 原因特定
  - [ ] 修正実施
  - [ ] 影響ユーザーが正常にログイン可能
  - [ ] 再発防止策の実施
```

## AIの責任

### 要求理解時

- WHYを必ず確認
- 曖昧な部分は質問
- ユーザーの言葉を解釈せず、そのまま記録

### 制約照合時

- 全ての関連ファイルを確認
- 矛盾を発見したら報告
- 過去の決定を尊重

### 要件化時

- 用語を統一
- 出所タグを付与
- [仮定]は `awaiting_review` に列挙
- 完了基準を明確に

## ユーザーの責任

- 要求の意図を説明
- [仮定]のレビューと承認
- 優先順位の決定
- 要件の最終承認

## 要件の記録

要件化した内容は以下に記録：

- **一時的な要件**: 会話内に記載、完了後はLOG.mdに要約
- **プロジェクト固有の要件**: `context/{project}.md`
- **決定事項**: `context/LOG.md`
- **新出用語**: `context/GLOSSARY.md`（提案）

## フロー図

```
ユーザー要求（曖昧）
    ↓
┌─────────────────┐
│ ① 要求理解      │ WHYを確認
│  - 意図確認     │ 背景を把握
│  - 背景把握     │ 期待を明確化
│  - 期待明確化   │
└─────────────────┘
    ↓
┌─────────────────┐
│ ② 制約照合      │ LOG.md
│  - 既存決定     │ GLOSSARY.md
│  - 用語定義     │ BEHAVIOR.md
│  - 境界線       │ {project}.md
└─────────────────┘
    ↓
  矛盾？
    ├─Yes→ エスカレーション
    ↓ No
┌─────────────────┐
│ ③ 要件化        │ 用語統一
│  - 具体化       │ 出所タグ付与
│  - 測定可能化   │ 完了基準設定
│  - 境界線明記   │
└─────────────────┘
    ↓
実行可能な要件
```

## まとめ

要求→要件変換は以下の原則で実施：

1. **要求理解**: WHYを最優先、意図を深く理解
2. **制約照合**: 既存決定との整合性を必ず確認
3. **要件化**: 用語統一、具体化、出所明示
4. **エスカレーション**: 不明点は確認、仮定は明示
5. **記録**: 決定事項はLOG.mdへ、用語はGLOSSARY.mdへ

これにより、曖昧な要求が実行可能な要件に変換され、誤解や手戻りを防ぐ。
